# CleverKeys v2.1 Roadmap
**Status**: Planning Phase
**Start Date**: TBD (after v2.0.2 manual testing complete)
**Target Release**: Q1 2026 (tentative)

---

## üéØ Release Goals

v2.1 focuses on **visual polish and accessibility compliance** based on findings from v2.0.2 UI verification.

**Primary Objectives**:
1. Fix confirmed visual rendering bugs
2. Achieve WCAG 2.1 Level AA compliance
3. Improve overall UI quality and consistency
4. Address user feedback from v2.0.2

---

## üìã Feature Backlog

### Priority 1: Accessibility (WCAG Compliance)

#### A1. Low Contrast Labels (P1 - Critical)
**Issue**: Secondary/tertiary labels fail WCAG 2.1 AA contrast ratio requirements

**Current State**:
- Secondary labels (NW, NE, SW, SE positions) have low contrast
- Examples: "Esc" on 'q', "we" on 'w', "I'd" on 'i', "Menu" on 'a'
- Difficult/impossible to read for users with visual impairments
- Violates accessibility standards

**Target**:
- Achieve 4.5:1 contrast ratio minimum (WCAG AA)
- Consider 7:1 for AAA compliance
- Test with color blindness simulators

**Implementation**:
- **File**: `src/main/kotlin/tribixbite/keyboard2/Theme.kt`
- **Method**: Adjust secondary label color calculations
- **Testing**: Use contrast checker tools, test all themes

**Estimated Effort**: 2-3 hours
**Risk**: Low (straightforward color adjustments)

---

#### A2. Small Touch Targets (P1 - Critical)
**Issue**: Arrow keys and modifier icons below 44x44 dp minimum

**Current State**:
- Arrow keys are very small
- Modifier icons difficult to tap accurately
- Increased mis-tap probability
- Violates accessibility guidelines

**Target**:
- Ensure ALL interactive targets meet 44x44 dp minimum
- Adjust spacing if needed to accommodate larger targets
- Maintain keyboard usability on smaller screens

**Implementation**:
- **File**: `src/main/kotlin/tribixbite/keyboard2/Keyboard2View.kt`
- **File**: Layout XML files (arrow key definitions)
- **Method**: Increase key sizes, adjust positioning
- **Testing**: Measure actual dp sizes on multiple devices

**Estimated Effort**: 4-6 hours (requires layout adjustments)
**Risk**: Medium (might affect overall keyboard layout)

---

### Priority 2: Visual Bugs (Rendering Issues)

#### V1. Missing Border Separator (P2 - Bug #469)
**Issue**: Missing vertical separator line between keys 5 and 6

**Current State**:
- Horizontal margins create gaps between keys
- Border drawing doesn't extend into margin space
- Visual inconsistency (all other keys have separators)

**Root Cause Analysis**:
- See `BUG_469_BORDER_FIX_ANALYSIS.md` for complete analysis
- Border drawn at reduced width: `keyWidth - horizontalMargin`
- Gap of `horizontalMargin` between adjacent keys has no border

**Proposed Solutions** (choose one after device testing):

**Option 1: Extend Right Border** (Recommended)
```kotlin
// In drawKeyFrame, extend right border to cover margin gap
val rightBorderExtension = tc.horizontalMargin / 2f
drawBorder(
    canvas,
    x + keyWidth - overlap,
    y,
    x + keyWidth + rightBorderExtension,  // Extend into margin
    y + keyHeight,
    tc.borderRightPaint,
    tc
)
```
- **Pros**: Minimal code change, fills gap
- **Cons**: Need to handle last key in row

**Option 2: Separator Lines**
```kotlin
// After each key (except last), draw explicit separator
if (keyIndex < row.keys.size - 1) {
    val separatorX = x + keyWidth + tc.horizontalMargin / 2f
    canvas.drawLine(separatorX, y, separatorX, y + keyHeight, tc.borderRightPaint)
}
```
- **Pros**: Explicit, easy to control
- **Cons**: Additional draw calls, need key index tracking

**Option 3: Full-Width Borders**
```kotlin
// Draw background at reduced width, borders at full width
val fullWidth = keyWidth + tc.horizontalMargin
// Background uses keyWidth, borders use fullWidth
```
- **Pros**: Architecturally clean
- **Cons**: Might create overlapping borders

**Implementation Steps**:
1. Verify issue exists on physical device (user confirmation needed)
2. Choose fix option based on verification results
3. Implement with edge case handling
4. Test all 100+ keyboard layouts
5. Verify no performance regression

**Estimated Effort**: 4-6 hours (includes testing)
**Risk**: Low-Medium (visual only, but many layouts to test)

---

#### V2. Label Spacing Optimization (P2 - Bug #470 appearance)
**Issue**: Labels "be" and "by" on 'b' key might render too close together

**Current State**:
- XML data is correct: `<key c="b" nw="be" ne="by" sw="/"/>`
- No "beby" exists in codebase
- Gemini AI reported seeing "beby ?", likely rendering artifact

**Investigation Needed**:
1. Verify if issue exists on physical device
2. Check label positioning logic for NW and NE labels
3. Measure actual spacing between adjacent labels

**Implementation** (if confirmed):
- **File**: `src/main/kotlin/tribixbite/keyboard2/Keyboard2View.kt`
- **Method**: `drawSubLabel()` - adjust label positioning
- **Change**: Increase minimum padding between NW and NE labels

**Estimated Effort**: 2-3 hours
**Risk**: Low (tuning existing logic)

---

### Priority 3: UI Polish (Enhancements)

#### U1. Theme Consistency Review
**Goal**: Ensure all visual elements are consistent across all 6 themes

**Tasks**:
- Review all predefined themes (Light, Dark, Everforest, Cobalt, Pine, ePaper)
- Verify contrast ratios for each theme
- Test border visibility in all themes
- Ensure label readability in all lighting conditions

**Estimated Effort**: 3-4 hours
**Risk**: Low

---

#### U2. Visual Regression Testing
**Goal**: Establish baseline for visual quality, detect future regressions

**Tasks**:
- Capture reference screenshots of all layouts
- Document expected visual appearance
- Create visual diff testing methodology
- Consider automated screenshot comparison

**Estimated Effort**: 6-8 hours
**Risk**: Low

---

### Priority 4: Design Concerns (Future Consideration)

#### D1. Overloaded Keys (P3 - UX Enhancement)
**Observation**: Most keys have 2-4 functions

**Examples**:
- ABC/Ctrl/123+ key (3 functions)
- Fn/emoji/settings key (3 functions)
- Most letter keys (primary + 2-3 alternates)

**Impact**:
- Cognitively demanding for new users
- Steep learning curve
- Not intuitive without tutorial

**Recommendation**: Consider simplification in v2.2+, monitor user feedback in v2.1

**Status**: NOT PLANNED for v2.1 (intentional design from Unexpected-Keyboard)

---

#### D2. Non-Standard Spacebar (P3 - UX Enhancement)
**Observation**: Spacebar is shortened with embedded symbols

**Impact**:
- Easier to miss during typing
- Non-standard for users familiar with traditional keyboards

**Recommendation**: Monitor user feedback, consider toggle option in v2.2+

**Status**: NOT PLANNED for v2.1 (intentional design trade-off for arrow keys)

---

#### D3. Interaction Model Clarity (P3 - UX Enhancement)
**Observation**: Not immediately clear how to access alternate functions

**Methods**: Tap, long-press, swipe (direction unclear)

**Recommendation**:
- Add in-app tutorial (v2.2)
- Improve documentation (v2.1)
- Consider visual hints or onboarding flow

**Status**: DOCUMENTATION ONLY for v2.1

---

## üß™ Testing Strategy

### Accessibility Testing

**Contrast Ratios**:
- Tool: https://webaim.org/resources/contrastchecker/
- Test all themes against WCAG 2.1 AA (4.5:1) and AAA (7:1)
- Document results in testing log

**Touch Targets**:
- Measure actual dp sizes on multiple devices
- Test with users who have motor impairments (if possible)
- Verify 44x44 dp minimum for all interactive elements

**Screen Readers**:
- Test with TalkBack enabled
- Verify all keys are properly announced
- Ensure proper content descriptions

---

### Visual Bug Testing

**Border Rendering**:
- Visual inspection of all 100+ layouts
- Verify borders between all adjacent keys
- Test edge cases: first/last keys, wide keys, special rows
- Test all themes (6 predefined + custom)

**Label Spacing**:
- Review all keys with multiple NW/NE labels
- Verify distinct separation, no visual overlaps
- Test at different screen sizes and densities

**Regression Testing**:
- Capture before/after screenshots
- Compare against reference images
- Verify no new issues introduced

---

### Device Testing

**Minimum**:
- 1 phone (5-6" screen)
- 1 tablet (8-10" screen)
- Various Android versions (8.0+, 12, 13, 14, 15)

**Screen Densities**:
- MDPI (160 dpi)
- HDPI (240 dpi)
- XHDPI (320 dpi)
- XXHDPI (480 dpi)

---

## üìä Success Criteria

### Must Have (Release Blockers)
- ‚úÖ WCAG 2.1 Level AA compliance achieved
- ‚úÖ All P1 accessibility issues resolved
- ‚úÖ Contrast ratio ‚â• 4.5:1 for all secondary labels
- ‚úÖ Touch targets ‚â• 44x44 dp for all interactive elements
- ‚úÖ No new bugs introduced (regression testing passes)

### Should Have (Important)
- ‚úÖ Bug #469 fixed (border separator visible)
- ‚úÖ Label spacing optimized (no visual overlaps)
- ‚úÖ Visual consistency across all themes
- ‚úÖ All 100+ layouts tested and verified

### Nice to Have (Enhancements)
- Documentation improvements (interaction model clarity)
- Visual regression testing framework
- User feedback collected and analyzed

---

## üìÖ Development Timeline (Tentative)

### Phase 1: Accessibility (Week 1)
- **Days 1-2**: Low contrast fixes (A1)
- **Days 3-5**: Touch target sizing (A2)
- **Day 6**: Accessibility testing
- **Day 7**: Documentation updates

**Deliverable**: WCAG 2.1 AA compliant keyboard

---

### Phase 2: Visual Bugs (Week 2)
- **Days 1-2**: Border rendering fix (V1)
- **Day 3**: Label spacing optimization (V2)
- **Days 4-5**: Visual bug testing (all layouts)
- **Day 6**: Theme consistency review (U1)
- **Day 7**: Regression testing

**Deliverable**: All visual bugs resolved

---

### Phase 3: Polish & Testing (Week 3)
- **Days 1-2**: Visual regression testing setup (U2)
- **Days 3-4**: Documentation updates
- **Day 5**: Device testing (multiple devices)
- **Day 6**: Bug fixes from testing
- **Day 7**: Final verification, build release candidate

**Deliverable**: v2.1.0-rc1 ready for beta testing

---

### Phase 4: Beta Testing (Week 4)
- **Days 1-3**: Beta testing with users
- **Days 4-5**: Fix critical issues from beta
- **Day 6**: Final build, documentation
- **Day 7**: Release v2.1.0

**Deliverable**: v2.1.0 public release

---

## üéØ Post-Release

### Metrics to Track
- User feedback on accessibility improvements
- Reports of visual bugs or regressions
- Adoption rate of v2.1 vs v2.0.2
- Accessibility feature usage analytics (if opt-in)

### Known Limitations
- Design concerns (D1-D3) deferred to v2.2+
- Tutorial/onboarding flow not implemented (documentation only)
- Custom theme creation UI not included (manual XML editing only)

---

## üìñ Related Documentation

### Planning & Analysis
- **UI_ISSUES_FOUND_NOV_20.md** - Gemini findings (9 issues)
- **UI_ISSUES_VERIFICATION_NOV_20.md** - Code verification
- **BUG_469_BORDER_FIX_ANALYSIS.md** - Border fix options
- **SESSION_UI_VERIFICATION_NOV_20_2025.md** - Verification session log

### Project Status
- **PROJECT_STATUS.md** - Current v2.0.2 status
- **ROADMAP.md** - Long-term vision (v2.1, v2.2, v3.0)
- **CHANGELOG.md** - Version history

### Technical Specs
- **docs/specs/ui-material3-modernization.md** - UI architecture
- **docs/specs/architectural-decisions.md** - ADRs (ONNX, coroutines, etc.)

---

## ‚ùì Open Questions

1. **Accessibility Priority**: Which is more critical - contrast or touch targets?
   - **Proposal**: Fix contrast first (easier), then touch targets
   - **Rationale**: Contrast affects all users, touch targets affect subset

2. **Border Fix Option**: Which of the 3 options should we implement?
   - **Proposal**: Option 1 (extend right border) - simplest, least risky
   - **Rationale**: Minimal code change, easy to test
   - **Decision Point**: After device verification confirms issue exists

3. **Theme Contrast Standards**: WCAG AA (4.5:1) or AAA (7:1)?
   - **Proposal**: AA as minimum, AAA as goal
   - **Rationale**: AA is required, AAA provides better accessibility

4. **Release Timeline**: 3 weeks or 4 weeks?
   - **Proposal**: 4 weeks with beta testing
   - **Rationale**: Quality over speed, beta feedback valuable

---

## üí° Future Considerations (v2.2+)

### Interaction Model
- In-app tutorial system
- First-run onboarding flow
- Interactive gesture hints
- Context-sensitive help

### Design Simplification
- Alternative "simple mode" layout option
- Reduced function counts per key
- Beginner-friendly preset

### Visual Customization
- GUI theme editor (no XML editing required)
- Visual color picker
- Real-time preview
- Theme sharing/import

---

## üîó Dependencies

### Blocked By
- v2.0.2 manual testing completion (Bug #468 verification)
- User feedback collection from v2.0.2 release

### Blocks
- v2.2 planning (design simplification features)
- Public beta program launch
- Google Play Store submission

---

**Roadmap Version**: 1.0
**Created**: November 20, 2025, 11:15 AM
**Status**: ‚è≥ **PLANNING** - Awaiting v2.0.2 testing completion
**Next Review**: After v2.0.2 manual testing

---

**Bottom Line**:
- v2.1 = Accessibility + Visual Polish
- Focus: WCAG compliance, border fix, label improvements
- Timeline: 4 weeks (3 weeks dev + 1 week beta)
- Goal: 100/100 accessibility score + visual perfection
