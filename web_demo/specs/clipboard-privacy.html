<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clipboard Privacy - CleverKeys Documentation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'ck-purple': '#9b59b6',
                        'ck-purple-dark': '#6b21a8',
                        'ck-purple-light': '#c39bd3',
                        'ck-dark': '#0f0f1a',
                        'ck-surface': '#1a1a2e',
                        'ck-card': '#242438',
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-text {
            background: linear-gradient(135deg, #9b59b6 0%, #c39bd3 50%, #9b59b6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="bg-ck-dark text-gray-100 min-h-screen">
    <!-- Nav -->
    <nav class="sticky top-0 bg-ck-dark/95 backdrop-blur border-b border-gray-800 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="../" class="flex items-center gap-3">
                <img src="https://raw.githubusercontent.com/tribixbite/CleverKeys/main/res/mipmap-xxxhdpi/ic_launcher.png" alt="CleverKeys" class="w-8 h-8 rounded-lg">
                <span class="font-bold">CleverKeys</span>
            </a>
            <div class="flex gap-4">
                <a href="./" class="text-gray-400 hover:text-white transition-colors">All Specs</a>
                <a href="../" class="text-gray-400 hover:text-white transition-colors">Home</a>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <div class="container mx-auto px-6 py-4 pt-20">
        <div class="flex items-center gap-2 text-sm text-gray-500">
            <a href="../" class="hover:text-ck-purple">Home</a>
            <span>/</span>
            <a href="./" class="hover:text-ck-purple">Specs</a>
            <span>/</span>
            <span class="text-gray-300">Clipboard Privacy</span>
        </div>
    </div>

    <!-- Header -->
    <header class="container mx-auto px-6 pb-8">
        <div class="flex items-center gap-3 mb-4">
            <span class="px-3 py-1 text-sm rounded-full" style="background: #f39c1220; color: #f39c12">Settings</span>
            <span class="px-3 py-1 text-sm rounded-full bg-ck-card text-gray-400">v1.2.8</span>
        </div>
        <h1 class="text-4xl font-bold gradient-text mb-2">Clipboard Privacy</h1>
        <p class="text-xl text-gray-400">Password manager exclusion for clipboard history</p>
    </header>

    <!-- Content -->
    <main class="container mx-auto px-6 pb-20">
        <div class="bg-ck-surface rounded-2xl p-8 max-w-4xl">
            <h1 class="text-3xl font-bold mb-6 gradient-text">Clipboard Privacy</h1>

<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Overview</h2>

<p class="mb-4 text-gray-300">CleverKeys includes privacy features for the clipboard history system, primarily automatic exclusion of clipboard entries from password managers. When enabled, CleverKeys detects when the foreground app is a password manager and skips storing clipboard content, preventing sensitive credentials from appearing in clipboard history.</p>

<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Key Files</h2>

<table class="w-full mb-4 border-collapse"><thead class="border-b border-gray-700"><tr><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">File</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Class/Function</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Purpose</th></tr></thead><tbody><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/Config.kt</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">PASSWORD_MANAGER_PACKAGES</code></td><td class="px-4 py-2 text-gray-300">Set of excluded package names</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/ClipboardHistoryService.kt</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">getForegroundAppPackage()</code></td><td class="px-4 py-2 text-gray-300">Detects current foreground app</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/ClipboardHistoryService.kt</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">isPasswordManagerApp()</code></td><td class="px-4 py-2 text-gray-300">Checks if package is excluded</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/ClipboardHistoryService.kt</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">addCurrentClip()</code></td><td class="px-4 py-2 text-gray-300">Skips storage if excluded app</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/SettingsActivity.kt</code></td><td class="px-4 py-2 text-gray-300">Clipboard section</td><td class="px-4 py-2 text-gray-300">UI toggle for feature</td></tr></tbody></table>
<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Architecture</h2>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-text">Clipboard Change Event
       |
       v
+----------------------+
| ClipboardHistory     | -- System notifies of clipboard change
| Service              |
+----------------------+
       |
       v
+----------------------+
| getForegroundApp     | -- Detect which app copied
| Package()            |
+----------------------+
       |
       v
+----------------------+
| isPasswordManager    | -- Check against exclusion list
| App()                |
+----------------------+
       |
       v (if NOT excluded)
+----------------------+
| Store to clipboard   | -- Save to history database
| history              |
+----------------------+</code></pre>

<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Configuration</h2>

<table class="w-full mb-4 border-collapse"><thead class="border-b border-gray-700"><tr><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Key</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Type</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Default</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Description</th></tr></thead><tbody><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">clipboard_exclude_password_managers</code></td><td class="px-4 py-2 text-gray-300">Boolean</td><td class="px-4 py-2 text-gray-300">true</td><td class="px-4 py-2 text-gray-300">Skip clipboard from password managers</td></tr></tbody></table>
<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Implementation Details</h2>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Supported Password Managers</h3>

<p class="mb-4 text-gray-300">Package names recognized (defined in <code class="bg-ck-dark px-1 rounded">Config.kt</code>):</p>

<table class="w-full mb-4 border-collapse"><thead class="border-b border-gray-700"><tr><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">App</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Package Name</th></tr></thead><tbody><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">Bitwarden</td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">com.x8bit.bitwarden</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">1Password</td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">com.onepassword.android</code>, <code class="bg-ck-dark px-1 rounded">com.agilebits.onepassword</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">LastPass</td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">com.lastpass.lpandroid</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">Dashlane</td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">com.dashlane</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">KeePass2Android</td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">keepass2android.keepass2android</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">KeePassDX</td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">com.kunzisoft.keepass.free</code>, <code class="bg-ck-dark px-1 rounded">com.kunzisoft.keepass.pro</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">Enpass</td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">io.enpass.app</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">NordPass</td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">com.nordpass.android.app.password.manager</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">RoboForm</td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">com.siber.roboform</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">Keeper</td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">com.callpod.android_apps.keeper</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">Proton Pass</td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">proton.android.pass</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">SafeInCloud</td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">com.safeincloud</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">mSecure</td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">com.msecure</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">Zoho Vault</td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">com.zoho.vault</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">Sticky Password</td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">com.stickypassword.android</code></td></tr></tbody></table>
<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Foreground App Detection</h3>

<p class="mb-4 text-gray-300">Primary method uses <code class="bg-ck-dark px-1 rounded">UsageStatsManager</code> (Android 5.1+):</p>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">private fun getForegroundAppPackage(): String? {
    val usageStatsManager = context.getSystemService(Context.USAGE_STATS_SERVICE)
        as UsageStatsManager
    val endTime = System.currentTimeMillis()
    val startTime = endTime - 1000 * 60  // Last minute

    val usageStats = usageStatsManager.queryUsageStats(
        UsageStatsManager.INTERVAL_DAILY, startTime, endTime
    )
    return usageStats.maxByOrNull { it.lastTimeUsed }?.packageName
}</code></pre>

<p class="mb-4 text-gray-300">Fallback uses <code class="bg-ck-dark px-1 rounded">ActivityManager</code> (deprecated but still works):</p>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">private fun getForegroundAppPackageFallback(): String? {
    val activityManager = context.getSystemService(Context.ACTIVITY_SERVICE)
        as ActivityManager
    val runningTasks = activityManager.getRunningTasks(1)
    return runningTasks.firstOrNull()?.topActivity?.packageName
}</code></pre>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Exclusion Check</h3>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">private fun isPasswordManagerApp(packageName: String?): Boolean {
    if (packageName == null) return false
    return PASSWORD_MANAGER_PACKAGES.contains(packageName)
}

private fun addCurrentClip() {
    if (config.clipboardExcludePasswordManagers) {
        val foregroundApp = getForegroundAppPackage()
        if (isPasswordManagerApp(foregroundApp)) {
            return  // Skip storage
        }
    }
    // Proceed with normal storage
    saveToHistory(clipboardManager.primaryClip)
}</code></pre>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Settings UI</h3>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">SettingsSwitch(
    title = "Exclude Password Managers",
    description = "Don't store clipboard from Bitwarden, 1Password, LastPass, KeePass, etc.",
    checked = clipboardExcludePasswordManagers,
    onCheckedChange = {
        clipboardExcludePasswordManagers = it
        saveSetting("clipboard_exclude_password_managers", it)
    }
)</code></pre>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Security Considerations</h3>

<ul class="mb-4 space-y-1"><li class="ml-4">&#8226; <strong>Detection Timing</strong>: Foreground app checked at moment clipboard changes</li>
<li class="ml-4">&#8226; <strong>False Positives</strong>: Very low - package names are specific</li>
<li class="ml-4">&#8226; <strong>False Negatives</strong>: Apps not in list won't be excluded</li>
<li class="ml-4">&#8226; <strong>Privacy</strong>: Detection is purely local, no data leaves device</li>
</ul>
<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Limitations</h3>

<ul class="mb-4 space-y-1"><li class="ml-4">&#8226; Requires UsageStats permission on some devices (optional, falls back to ActivityManager)</li>
<li class="ml-4">&#8226; New password managers must be added to the package list manually</li>
<li class="ml-4">&#8226; Does not analyze clipboard content - only checks source app</li>
</ul>
        </div>
    </main>

    <!-- Footer -->
    <footer class="container mx-auto px-6 py-8 text-center text-gray-500 text-sm border-t border-gray-800">
        <p>CleverKeys Documentation - Generated from specs</p>
    </footer>
</body>
</html>