<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cursor Navigation - CleverKeys Documentation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'ck-purple': '#9b59b6',
                        'ck-purple-dark': '#6b21a8',
                        'ck-purple-light': '#c39bd3',
                        'ck-dark': '#0f0f1a',
                        'ck-surface': '#1a1a2e',
                        'ck-card': '#242438',
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-text {
            background: linear-gradient(135deg, #9b59b6 0%, #c39bd3 50%, #9b59b6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="bg-ck-dark text-gray-100 min-h-screen">
    <!-- Nav -->
    <nav class="sticky top-0 bg-ck-dark/95 backdrop-blur border-b border-gray-800 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="../" class="flex items-center gap-3">
                <img src="https://raw.githubusercontent.com/tribixbite/CleverKeys/main/res/mipmap-xxxhdpi/ic_launcher.png" alt="CleverKeys" class="w-8 h-8 rounded-lg">
                <span class="font-bold">CleverKeys</span>
            </a>
            <div class="flex gap-4">
                <a href="./" class="text-gray-400 hover:text-white transition-colors">All Specs</a>
                <a href="../" class="text-gray-400 hover:text-white transition-colors">Home</a>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <div class="container mx-auto px-6 py-4 pt-20">
        <div class="flex items-center gap-2 text-sm text-gray-500">
            <a href="../" class="hover:text-ck-purple">Home</a>
            <span>/</span>
            <a href="./" class="hover:text-ck-purple">Specs</a>
            <span>/</span>
            <span class="text-gray-300">Cursor Navigation</span>
        </div>
    </div>

    <!-- Header -->
    <header class="container mx-auto px-6 pb-8">
        <div class="flex items-center gap-3 mb-4">
            <span class="px-3 py-1 text-sm rounded-full" style="background: #2ecc7120; color: #2ecc71">Navigation</span>
            <span class="px-3 py-1 text-sm rounded-full bg-ck-card text-gray-400">v1.1.0</span>
        </div>
        <h1 class="text-4xl font-bold gradient-text mb-2">Cursor Navigation</h1>
        <p class="text-xl text-gray-400">Spacebar slider and arrow key navigation</p>
    </header>

    <!-- Content -->
    <main class="container mx-auto px-6 pb-20">
        <div class="bg-ck-surface rounded-2xl p-8 max-w-4xl">
            <h1 class="text-3xl font-bold mb-6 gradient-text">Cursor Navigation System</h1>

<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Overview</h2>

<p class="mb-4 text-gray-300">CleverKeys provides two distinct cursor navigation mechanisms: slider-based cursor (spacebar) for continuous movement scaled by distance and speed, and arrow key navigation (dedicated nav key) for discrete single-character movement. Both are accessed via swipe gestures on bottom row keys.</p>

<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Key Files</h2>

<table class="w-full mb-4 border-collapse"><thead class="border-b border-gray-700"><tr><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">File</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Class/Function</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Purpose</th></tr></thead><tbody><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/Pointers.kt</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">Sliding</code> inner class</td><td class="px-4 py-2 text-gray-300">Touch tracking and movement calculation</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/KeyValue.kt</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">Slider</code> enum</td><td class="px-4 py-2 text-gray-300">Cursor key definitions</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/KeyEventHandler.kt</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">handleSlider()</code>, <code class="bg-ck-dark px-1 rounded">moveCursor()</code></td><td class="px-4 py-2 text-gray-300">Cursor movement execution</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/Config.kt</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">swipe_scaling</code>, <code class="bg-ck-dark px-1 rounded">slide_step_px</code></td><td class="px-4 py-2 text-gray-300">Configuration and scaling</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">res/xml/bottom_row.xml</code></td><td class="px-4 py-2 text-gray-300">Key layout</td><td class="px-4 py-2 text-gray-300">Swipe direction mappings</td></tr></tbody></table>
<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Architecture</h2>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Layout Configuration</h3>

<p class="mb-4 text-gray-300">From <code class="bg-ck-dark px-1 rounded">res/xml/bottom_row.xml</code>:</p>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-xml">&lt;!-- Spacebar: Slider-based cursor (continuous) --&gt;
&lt;key width="4.4" key0="space" key5="cursor_left" key6="cursor_right"
     key7="switch_forward" key8="switch_backward"/&gt;

&lt;!-- Navigation key: Arrow keys (discrete) --&gt;
&lt;key key0="loc compose" key5="left" key6="right" key7="up" key8="down"
     key1="loc home" key2="loc page_up" key3="loc end" key4="loc page_down"/&gt;</code></pre>

<p class="mb-4 text-gray-300"><strong>Swipe direction mapping:</strong></p>
<ul class="mb-4 space-y-1"><li class="ml-4">&#8226; <code class="bg-ck-dark px-1 rounded">key5</code> = West (left swipe)</li>
<li class="ml-4">&#8226; <code class="bg-ck-dark px-1 rounded">key6</code> = East (right swipe)</li>
<li class="ml-4">&#8226; <code class="bg-ck-dark px-1 rounded">key7</code> = North (up swipe)</li>
<li class="ml-4">&#8226; <code class="bg-ck-dark px-1 rounded">key8</code> = South (down swipe)</li>
</ul>
<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Configuration</h2>

<table class="w-full mb-4 border-collapse"><thead class="border-b border-gray-700"><tr><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Key</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Type</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Default</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Description</th></tr></thead><tbody><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">slider_sensitivity</code></td><td class="px-4 py-2 text-gray-300">Int</td><td class="px-4 py-2 text-gray-300">30</td><td class="px-4 py-2 text-gray-300">% - Pixels per cursor movement (lower = more sensitive)</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">slider_speed_smoothing</code></td><td class="px-4 py-2 text-gray-300">Float</td><td class="px-4 py-2 text-gray-300">0.6</td><td class="px-4 py-2 text-gray-300">Exponential smoothing factor (0.0-1.0)</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">slider_speed_max</code></td><td class="px-4 py-2 text-gray-300">Float</td><td class="px-4 py-2 text-gray-300">6.0</td><td class="px-4 py-2 text-gray-300">Maximum speed multiplier</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">SLIDING_SPEED_VERTICAL_MULT</code></td><td class="px-4 py-2 text-gray-300">Float</td><td class="px-4 py-2 text-gray-300">0.5</td><td class="px-4 py-2 text-gray-300">Vertical movement reduction factor</td></tr></tbody></table>
<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Implementation Details</h2>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Slider Key Types</h3>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">// KeyValue.kt
enum class Slider(val symbol: String) {
    Cursor_left("\uE008"),
    Cursor_right("\uE006"),
    Cursor_up("\uE005"),
    Cursor_down("\uE007"),
    Selection_cursor_left("\uE008"),   // Extends selection leftward
    Selection_cursor_right("\uE006");  // Extends selection rightward
}</code></pre>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">The <code class="bg-ck-dark px-1 rounded">swipe_scaling</code> Calculation</h3>

<p class="mb-4 text-gray-300">Device-adaptive scaling ensures consistent behavior across different screen sizes:</p>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">// Config.kt
val dpi_ratio = maxOf(dm.xdpi, dm.ydpi) / minOf(dm.xdpi, dm.ydpi)
val swipe_scaling = minOf(dm.widthPixels, dm.heightPixels) / 10f * dpi_ratio

val slider_sensitivity = prefs.getString("slider_sensitivity", "30").toFloat() / 100f
slide_step_px = slider_sensitivity * swipe_scaling</code></pre>

<p class="mb-4 text-gray-300"><strong>Example calculations by device:</strong></p>

<table class="w-full mb-4 border-collapse"><thead class="border-b border-gray-700"><tr><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Device</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Width</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">DPI Ratio</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">swipe_scaling</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">slide_step_px (30%)</th></tr></thead><tbody><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">1080p phone</td><td class="px-4 py-2 text-gray-300">1080px</td><td class="px-4 py-2 text-gray-300">1.0</td><td class="px-4 py-2 text-gray-300">108</td><td class="px-4 py-2 text-gray-300">32.4px</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">1440p phone</td><td class="px-4 py-2 text-gray-300">1440px</td><td class="px-4 py-2 text-gray-300">1.0</td><td class="px-4 py-2 text-gray-300">144</td><td class="px-4 py-2 text-gray-300">43.2px</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">720p phone</td><td class="px-4 py-2 text-gray-300">720px</td><td class="px-4 py-2 text-gray-300">1.0</td><td class="px-4 py-2 text-gray-300">72</td><td class="px-4 py-2 text-gray-300">21.6px</td></tr></tbody></table>
<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Sliding Algorithm</h3>

<p class="mb-4 text-gray-300">Located in <code class="bg-ck-dark px-1 rounded">Pointers.kt</code>:</p>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">inner class Sliding(
    x: Float, y: Float,
    val direction_x: Int,  // Â±1 based on initial swipe direction
    val direction_y: Int,
    val slider: KeyValue.Slider
) {
    var d = 0f              // Accumulated fractional cursor movements
    var speed = 0.5f        // Current speed multiplier (0.5 - max)
    var last_move_ms: Long  // Timestamp for speed calculation
}

fun onTouchMove(ptr: Pointer, x: Float, y: Float) {
    val travelled = abs(x - last_x) + abs(y - last_y)

    // Accumulate distance with speed multiplier
    d += ((x - last_x) * speed * direction_x +
          (y - last_y) * speed * SLIDING_SPEED_VERTICAL_MULT * direction_y) /
         _config.slide_step_px

    // Send cursor event for each whole unit accumulated
    val d_ = d.toInt()
    if (d_ != 0) {
        d -= d_
        _handler.onPointerHold(KeyValue.sliderKey(slider, d_), ptr.modifiers)
    }

    update_speed(travelled, x, y)
}

fun update_speed(travelled: Float, x: Float, y: Float) {
    val now = System.currentTimeMillis()
    val instant_speed = min(slider_speed_max, travelled / (now - last_move_ms) + 1f)
    speed = speed + (instant_speed - speed) * slider_speed_smoothing
    last_move_ms = now
}</code></pre>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Swipe Behavior Examples</h3>

<table class="w-full mb-4 border-collapse"><thead class="border-b border-gray-700"><tr><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Swipe Type</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Distance</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Time</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Speed</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Cursor Moves</th></tr></thead><tbody><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">Short, slow</td><td class="px-4 py-2 text-gray-300">50px</td><td class="px-4 py-2 text-gray-300">200ms</td><td class="px-4 py-2 text-gray-300">~1.0</td><td class="px-4 py-2 text-gray-300">1-2 positions</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">Long, slow</td><td class="px-4 py-2 text-gray-300">200px</td><td class="px-4 py-2 text-gray-300">800ms</td><td class="px-4 py-2 text-gray-300">~1.2</td><td class="px-4 py-2 text-gray-300">7-8 positions</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">Fast</td><td class="px-4 py-2 text-gray-300">150px</td><td class="px-4 py-2 text-gray-300">75ms</td><td class="px-4 py-2 text-gray-300">~2.5</td><td class="px-4 py-2 text-gray-300">11-12 positions</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">Very fast</td><td class="px-4 py-2 text-gray-300">200px</td><td class="px-4 py-2 text-gray-300">40ms</td><td class="px-4 py-2 text-gray-300">~4.5 (capped at 6)</td><td class="px-4 py-2 text-gray-300">27-28 positions</td></tr></tbody></table>
<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Arrow Key Navigation</h3>

<p class="mb-4 text-gray-300">Discrete movement via DPAD key events:</p>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">// KeyValue.kt
"up" -&gt; keyeventKey(0xE005, KeyEvent.KEYCODE_DPAD_UP, 0)
"right" -&gt; keyeventKey(0xE006, KeyEvent.KEYCODE_DPAD_RIGHT, FLAG_SMALLER_FONT)
"down" -&gt; keyeventKey(0xE007, KeyEvent.KEYCODE_DPAD_DOWN, 0)
"left" -&gt; keyeventKey(0xE008, KeyEvent.KEYCODE_DPAD_LEFT, FLAG_SMALLER_FONT)</code></pre>

<p class="mb-4 text-gray-300">Each swipe triggers exactly ONE key event - no distance or speed scaling.</p>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Comparison Table</h3>

<table class="w-full mb-4 border-collapse"><thead class="border-b border-gray-700"><tr><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Feature</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Spacebar Slider</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Nav Key Arrows</th></tr></thead><tbody><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><strong>Key values</strong></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">cursor_left</code>, <code class="bg-ck-dark px-1 rounded">cursor_right</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">left</code>, <code class="bg-ck-dark px-1 rounded">right</code>, <code class="bg-ck-dark px-1 rounded">up</code>, <code class="bg-ck-dark px-1 rounded">down</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><strong>Movement type</strong></td><td class="px-4 py-2 text-gray-300">Continuous (fractional accumulation)</td><td class="px-4 py-2 text-gray-300">Discrete (one per swipe)</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><strong>Speed-sensitive</strong></td><td class="px-4 py-2 text-gray-300">Yes (1x to 6x multiplier)</td><td class="px-4 py-2 text-gray-300">No</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><strong>Distance-sensitive</strong></td><td class="px-4 py-2 text-gray-300">Yes (proportional)</td><td class="px-4 py-2 text-gray-300">No</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><strong>Output method</strong></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">InputConnection.setSelection()</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">KeyEvent.KEYCODE_DPAD_*</code></td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><strong>Use case</strong></td><td class="px-4 py-2 text-gray-300">Quick navigation through text</td><td class="px-4 py-2 text-gray-300">Precise single-char movement</td></tr></tbody></table>
<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Cursor Movement Execution</h3>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">// KeyEventHandler.kt
private fun handleSlider(s: KeyValue.Slider, r: Int, keyDown: Boolean) {
    when (s) {
        Slider.Cursor_left -&gt; moveCursor(-r)
        Slider.Cursor_right -&gt; moveCursor(r)
        Slider.Cursor_up -&gt; moveCursorVertical(-r)
        Slider.Cursor_down -&gt; moveCursorVertical(r)
        Slider.Selection_cursor_left -&gt; moveCursorSel(r, true, keyDown)
        Slider.Selection_cursor_right -&gt; moveCursorSel(r, false, keyDown)
    }
}

private fun moveCursor(d: Int) {
    val conn = recv.getCurrentInputConnection() ?: return
    val et = getCursorPos(conn)

    if (et != null &amp;&amp; canSetSelection(conn)) {
        var selEnd = et.selectionEnd + d
        var selStart = if ((metaState and KeyEvent.META_SHIFT_ON) == 0) selEnd else et.selectionStart
        conn.setSelection(selStart, selEnd)
    } else {
        moveCursorFallback(d)  // Send arrow key events
    }
}</code></pre>

        </div>
    </main>

    <!-- Footer -->
    <footer class="container mx-auto px-6 py-8 text-center text-gray-500 text-sm border-t border-gray-800">
        <p>CleverKeys Documentation - Generated from specs</p>
    </footer>
</body>
</html>