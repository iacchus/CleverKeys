<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Short Swipe Customization - CleverKeys Documentation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'ck-purple': '#9b59b6',
                        'ck-purple-dark': '#6b21a8',
                        'ck-purple-light': '#c39bd3',
                        'ck-dark': '#0f0f1a',
                        'ck-surface': '#1a1a2e',
                        'ck-card': '#242438',
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-text {
            background: linear-gradient(135deg, #9b59b6 0%, #c39bd3 50%, #9b59b6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="bg-ck-dark text-gray-100 min-h-screen">
    <!-- Nav -->
    <nav class="sticky top-0 bg-ck-dark/95 backdrop-blur border-b border-gray-800 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="../" class="flex items-center gap-3">
                <img src="https://raw.githubusercontent.com/tribixbite/CleverKeys/main/res/mipmap-xxxhdpi/ic_launcher.png" alt="CleverKeys" class="w-8 h-8 rounded-lg">
                <span class="font-bold">CleverKeys</span>
            </a>
            <div class="flex gap-4">
                <a href="./" class="text-gray-400 hover:text-white transition-colors">All Specs</a>
                <a href="../" class="text-gray-400 hover:text-white transition-colors">Home</a>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <div class="container mx-auto px-6 py-4 pt-20">
        <div class="flex items-center gap-2 text-sm text-gray-500">
            <a href="../" class="hover:text-ck-purple">Home</a>
            <span>/</span>
            <a href="./" class="hover:text-ck-purple">Specs</a>
            <span>/</span>
            <span class="text-gray-300">Short Swipe Customization</span>
        </div>
    </div>

    <!-- Header -->
    <header class="container mx-auto px-6 pb-8">
        <div class="flex items-center gap-3 mb-4">
            <span class="px-3 py-1 text-sm rounded-full" style="background: #e74c3c20; color: #e74c3c">Customization</span>
            <span class="px-3 py-1 text-sm rounded-full bg-ck-card text-gray-400">v1.2.0</span>
        </div>
        <h1 class="text-4xl font-bold gradient-text mb-2">Short Swipe Customization</h1>
        <p class="text-xl text-gray-400">Per-key gesture customization with 8 directions</p>
    </header>

    <!-- Content -->
    <main class="container mx-auto px-6 pb-20">
        <div class="bg-ck-surface rounded-2xl p-8 max-w-4xl">
            <h1 class="text-3xl font-bold mb-6 gradient-text">Short Swipe Customization</h1>

<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Overview</h2>

<p class="mb-4 text-gray-300">Short Swipe Customization allows users to fully customize the 8-direction swipe gestures for every key on the keyboard. Each key has 8 subkey positions (N, NE, E, SE, S, SW, W, NW) that can be customized with text input, commands, or key events through a dedicated settings UI.</p>

<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Key Files</h2>

<table class="w-full mb-4 border-collapse"><thead class="border-b border-gray-700"><tr><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">File</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Class/Function</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Purpose</th></tr></thead><tbody><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/customization/SwipeDirection.kt</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">SwipeDirection</code></td><td class="px-4 py-2 text-gray-300">Enum for 8 directions</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/customization/ActionType.kt</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">ActionType</code></td><td class="px-4 py-2 text-gray-300">Enum for action types</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/customization/ShortSwipeMapping.kt</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">ShortSwipeMapping</code></td><td class="px-4 py-2 text-gray-300">Data model for custom mapping</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/customization/ShortSwipeCustomizationManager.kt</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">ShortSwipeCustomizationManager</code></td><td class="px-4 py-2 text-gray-300">JSON persistence, CRUD operations</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/customization/CustomShortSwipeExecutor.kt</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">CustomShortSwipeExecutor</code></td><td class="px-4 py-2 text-gray-300">Executes commands via InputConnection</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/customization/CommandRegistry.kt</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">CommandRegistry</code></td><td class="px-4 py-2 text-gray-300">200+ searchable commands</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/Pointers.kt</code></td><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">handleShortGesture()</code></td><td class="px-4 py-2 text-gray-300">Checks custom mappings first</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">src/main/kotlin/tribixbite/cleverkeys/KeyEventHandler.kt</code></td><td class="px-4 py-2 text-gray-300">Integration</td><td class="px-4 py-2 text-gray-300">Executes custom commands</td></tr></tbody></table>
<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Architecture</h2>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-text">Settings UI
       |
       v
+----------------------------------+
| ShortSwipeCustomization          | -- User selects key, direction, action
| Activity                         |
+----------------------------------+
       |
       v
+----------------------------------+
| ShortSwipeCustomization          | -- CRUD for mappings
| Manager                          | -- JSON persistence
+----------------------------------+
       |
       v (on gesture)
+----------------------------------+
| Pointers.handleShortGesture()    | -- Check custom mapping first
+----------------------------------+
       |
       v (if custom found)
+----------------------------------+
| CustomShortSwipeExecutor         | -- Execute TEXT/COMMAND/KEY_EVENT
| .execute()                       |
+----------------------------------+</code></pre>

<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Data Model</h2>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">SwipeDirection</h3>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">enum class SwipeDirection {
    N,   // North (up)
    NE,  // Northeast
    E,   // East (right)
    SE,  // Southeast
    S,   // South (down)
    SW,  // Southwest
    W,   // West (left)
    NW   // Northwest
}</code></pre>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">ActionType</h3>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">enum class ActionType {
    TEXT,      // Insert text string (up to 100 chars)
    COMMAND,   // Execute editing command from CommandRegistry
    KEY_EVENT  // Send Android KeyEvent
}</code></pre>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">ShortSwipeMapping</h3>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">data class ShortSwipeMapping(
    val keyCode: String,           // Key identifier (e.g., "a", "e", "shift")
    val direction: SwipeDirection, // One of 8 directions
    val displayText: String,       // Max 4 chars for visual display
    val actionType: ActionType,    // TEXT, COMMAND, or KEY_EVENT
    val actionValue: String,       // Text content or command name
    val useKeyFont: Boolean = false // Use special_font.ttf for icons
)</code></pre>

<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Storage Format</h2>

<p class="mb-4 text-gray-300">File: <code class="bg-ck-dark px-1 rounded">short_swipe_customizations.json</code></p>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-json">{
  "version": 2,
  "mappings": {
    "a": {
      "N": { "displayText": "@", "actionType": "TEXT", "actionValue": "@", "useKeyFont": false },
      "NE": { "displayText": "sel", "actionType": "COMMAND", "actionValue": "select_all", "useKeyFont": false }
    },
    "e": {
      "NW": { "displayText": "", "actionType": "COMMAND", "actionValue": "home", "useKeyFont": true }
    }
  }
}</code></pre>

<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Available Commands</h2>

<p class="mb-4 text-gray-300">CommandRegistry contains 200+ commands in 18 categories:</p>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Core Categories</h3>

<table class="w-full mb-4 border-collapse"><thead class="border-b border-gray-700"><tr><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Category</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Example Commands</th></tr></thead><tbody><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">CLIPBOARD</code></td><td class="px-4 py-2 text-gray-300">copy, paste, cut, paste_plain</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">EDITING</code></td><td class="px-4 py-2 text-gray-300">undo, redo, select_all</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">CURSOR</code></td><td class="px-4 py-2 text-gray-300">cursor_left, cursor_right, home, end</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">NAVIGATION</code></td><td class="px-4 py-2 text-gray-300">page_up, page_down, doc_home, doc_end</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">SELECTION</code></td><td class="px-4 py-2 text-gray-300">select_all, selection_mode</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">DELETE</code></td><td class="px-4 py-2 text-gray-300">delete_word, forward_delete_word</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">MODIFIERS</code></td><td class="px-4 py-2 text-gray-300">shift, ctrl, alt, meta, fn</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">FUNCTION_KEYS</code></td><td class="px-4 py-2 text-gray-300">f1-f12</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">SPECIAL_KEYS</code></td><td class="px-4 py-2 text-gray-300">escape, tab, insert, print_screen</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">EVENTS</code></td><td class="px-4 py-2 text-gray-300">config, change_method, action, caps_lock</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">MEDIA</code></td><td class="px-4 py-2 text-gray-300">media_play_pause, volume_up, volume_down</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">SYSTEM</code></td><td class="px-4 py-2 text-gray-300">search, calculator, calendar, brightness_up</td></tr></tbody></table>
<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Diacritics Categories</h3>

<table class="w-full mb-4 border-collapse"><thead class="border-b border-gray-700"><tr><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Category</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Example Commands</th></tr></thead><tbody><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">DIACRITICS</code></td><td class="px-4 py-2 text-gray-300">combining_grave, combining_acute</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">DIACRITICS_SLAVONIC</code></td><td class="px-4 py-2 text-gray-300">combining_titlo, combining_palatalization</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">DIACRITICS_ARABIC</code></td><td class="px-4 py-2 text-gray-300">arabic_fatha, arabic_kasra, arabic_sukun</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300"><code class="bg-ck-dark px-1 rounded">HEBREW</code></td><td class="px-4 py-2 text-gray-300">hebrew_dagesh, hebrew_qamats, hebrew_tsere</td></tr></tbody></table>
<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Public API</h2>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">ShortSwipeCustomizationManager</h3>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">class ShortSwipeCustomizationManager(context: Context) {
    // Get mapping for specific key and direction
    fun getMapping(keyCode: String, direction: SwipeDirection): ShortSwipeMapping?

    // Save or update a mapping
    fun saveMapping(mapping: ShortSwipeMapping)

    // Delete a mapping
    fun deleteMapping(keyCode: String, direction: SwipeDirection)

    // Get all mappings for a key
    fun getMappingsForKey(keyCode: String): Map&lt;SwipeDirection, ShortSwipeMapping&gt;

    // Reset all customizations
    fun resetAll()

    // Export for backup
    fun exportToJson(): String

    // Import from backup
    fun importFromJson(json: String)
}</code></pre>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">CustomShortSwipeExecutor</h3>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">class CustomShortSwipeExecutor(
    private val inputConnection: InputConnection,
    private val keyEventHandler: KeyEventHandler
) {
    fun execute(mapping: ShortSwipeMapping): Boolean {
        return when (mapping.actionType) {
            ActionType.TEXT -&gt; {
                inputConnection.commitText(mapping.actionValue, 1)
                true
            }
            ActionType.COMMAND -&gt; {
                executeCommand(mapping.actionValue)
            }
            ActionType.KEY_EVENT -&gt; {
                sendKeyEvent(mapping.actionValue.toIntOrNull())
            }
        }
    }
}</code></pre>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">CommandRegistry</h3>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">object CommandRegistry {
    // Get all commands grouped by category
    fun getAllCommands(): Map&lt;Category, List&lt;Command&gt;&gt;

    // Search commands by keyword
    fun search(query: String): List&lt;Command&gt;

    // Get display info (icon + useKeyFont flag)
    fun getDisplayInfo(commandName: String): DisplayInfo?

    data class Command(
        val name: String,
        val category: Category,
        val keywords: List&lt;String&gt;,
        val description: String
    )
}</code></pre>

<h2 class="text-2xl font-bold mt-8 mb-4 text-ck-purple">Implementation Details</h2>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Integration with Pointers.kt</h3>

<p class="mb-4 text-gray-300">Custom mappings are checked before built-in subkeys:</p>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">private fun handleShortGesture(ptr: Pointer, direction: SwipeDirection) {
    // Check custom mapping first
    val customMapping = customizationManager.getMapping(ptr.key.name, direction)
    if (customMapping != null) {
        customExecutor.execute(customMapping)
        return
    }

    // Fall back to built-in subkey
    val subkey = ptr.key.getSubkey(direction)
    if (subkey != null) {
        handleKeyPress(subkey)
    }
}</code></pre>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Modifier Key Support</h3>

<p class="mb-4 text-gray-300">Custom mappings work even with Shift/Ctrl/Alt active:</p>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">private fun shouldBlockBuiltInGesture(): Boolean {
    // Built-in gestures blocked when modifiers active
    return modifierState != 0
}

// But custom mappings always execute
if (customMapping != null) {
    customExecutor.execute(customMapping)  // Executes regardless of modifiers
    return
}

// Built-in check happens after
if (shouldBlockBuiltInGesture()) {
    return  // Block built-in subkey
}</code></pre>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Icon Font Rendering</h3>

<p class="mb-4 text-gray-300">Custom mappings can use <code class="bg-ck-dark px-1 rounded">special_font.ttf</code> for icon display:</p>

<pre class="bg-ck-dark p-4 rounded-lg overflow-x-auto"><code class="language-kotlin">// In Keyboard2View
private fun drawCustomSubLabel(canvas: Canvas, mapping: ShortSwipeMapping, x: Float, y: Float) {
    val paint = if (mapping.useKeyFont) {
        sublabelPaint.apply { typeface = specialFont }
    } else {
        sublabelPaint.apply { typeface = Typeface.DEFAULT }
    }
    canvas.drawText(mapping.displayText, x, y, paint)
}</code></pre>

<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Direction Zone Colors (UI)</h3>

<p class="mb-4 text-gray-300">The customization UI uses distinct colors for each direction:</p>

<table class="w-full mb-4 border-collapse"><thead class="border-b border-gray-700"><tr><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Direction</th><th class="px-4 py-2 text-left font-semibold text-ck-purple-light">Color</th></tr></thead><tbody><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">NW</td><td class="px-4 py-2 text-gray-300">Red (#FF6B6B)</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">N</td><td class="px-4 py-2 text-gray-300">Teal (#4ECDC4)</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">NE</td><td class="px-4 py-2 text-gray-300">Yellow (#FFE66D)</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">W</td><td class="px-4 py-2 text-gray-300">Mint (#95E1D3)</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">E</td><td class="px-4 py-2 text-gray-300">Coral (#F38181)</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">SW</td><td class="px-4 py-2 text-gray-300">Purple (#AA96DA)</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">S</td><td class="px-4 py-2 text-gray-300">Cyan (#72D4E8)</td></tr><tr class="border-b border-gray-800"><td class="px-4 py-2 text-gray-300">SE</td><td class="px-4 py-2 text-gray-300">Pink (#FCBAD3)</td></tr></tbody></table>
<h3 class="text-xl font-semibold mt-6 mb-3 text-ck-purple-light">Performance</h3>

<ul class="mb-4 space-y-1"><li class="ml-4">&#8226; Custom mapping lookup: < 1ms (HashMap)</li>
<li class="ml-4">&#8226; UI response time: < 16ms (60fps)</li>
<li class="ml-4">&#8226; JSON storage load: < 100ms</li>
</ul>
        </div>
    </main>

    <!-- Footer -->
    <footer class="container mx-auto px-6 py-8 text-center text-gray-500 text-sm border-t border-gray-800">
        <p>CleverKeys Documentation - Generated from specs</p>
    </footer>
</body>
</html>